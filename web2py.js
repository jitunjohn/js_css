!function($,undefined){"use strict";$.web2py!==undefined&&$.error("web2py.js has already been loaded!");var FORMDATA_IS_SUPPORTED="undefined"!=typeof FormData,animateIn="fadeIn",web2py;String.prototype.reverse=function(){return this.split("").reverse().join("")},$.web2py=web2py={isUndefined:function(e){return void 0===e},popup:function(e){e=window.open(e,"name","height=400,width=600");return window.focus&&e.focus(),!1},collapse:function(e){$("#"+e).slideToggle()},fade:function(e,t){0<t?$("#"+e).hide().fadeIn("slow"):$("#"+e).show().fadeOut("slow")},ajax:function(u,s,t,options){options=void 0!==options?options:{};var query="";if("string"==typeof s){var d=$(s).serialize();d&&(query=d)}else{var pcs=[];if(null!==s&&!web2py.isUndefined(s))for(var i=0;i<s.length;i++){var q=$("[name="+s[i]+"]").serialize();q&&pcs.push(q)}0<pcs.length&&(query=pcs.join("&"))}var success_function=function(msg){t&&(":eval"==t?eval(msg):"string"==typeof t?$("#"+t).html(msg):t(msg))},success=[success_function];$.isArray(options.done)?success=$.merge(success,options.done):success.push(options.done);var ajax_options={type:"POST",url:u,data:query,success:success},attrname;for(attrname in delete options.done,options)ajax_options[attrname]=options[attrname];$.ajax(ajax_options)},ajax_fields:function(e){$('button:not([class^="btn"])',e).addClass("btn"),$('form input[type="submit"]:not([class^="btn"]), form input[type="button"]:not([class^="btn"])',e).addClass("btn"),$("input[type=password][data-w2p_entropy]",e).each(function(){web2py.validate_entropy($(this))}),$("ul.w2p_list",e).each(function(){function t(e,t){var a,a=((a=$(e).find("li:first").clone(!0)).find(":text").val(""),a);return $(e).find("li").each(function(){var e=$.trim($(this.firstChild).val());""===e?$(this).remove():$(this.firstChild).val(e)}),$(t.target).parent().is(":visible")?a.insertAfter($(t.target).parent()):a.appendTo(e),a.find(":text").focus(),!1}var a=this;$(a).find(":text").after('<a href="#">+</a>&nbsp;<a href="#">-</a>').keypress(function(e){return 13!=e.which||t(a,e)}).next().click(function(e){t(a,e),e.preventDefault()}).next().click(function(e){var t;t=e,1<$(a).children().length&&$(t.target).parent().remove(),e.preventDefault()})})},ajax_init:function(e){$(".w2p_hidden",e).hide(),web2py.manage_errors(e),web2py.ajax_fields(e),web2py.show_if_handler(e),web2py.component_handler(e)},manage_errors:function(e){$("div.error",e).hide()[animateIn]("slow")},after_ajax:function(xhr){var command=xhr.getResponseHeader("web2py-component-command"),flash=xhr.getResponseHeader("web2py-component-flash");null!==command&&eval(decodeURIComponent(command)),flash&&web2py.flash(decodeURIComponent(flash))},event_handlers:function(){var e=$(document);e.on("click",".w2p_flash",function(e){e.preventDefault();e=$(this);"0px"==e.css("top")?e.slideUp("slow"):e.fadeOut()}),e.on("keyup","input.integer",function(){var e=this.value.reverse().replace(/[^0-9\-]|\-(?=.)/g,"").reverse();this.value!=e&&(this.value=e)}),e.on("keyup","input.double, input.decimal",function(){var e=this.value.reverse().replace(/[^0-9\-\.,]|[\-](?=.)|[\.,](?=[0-9]*[\.,])/g,"").reverse();this.value!=e&&(this.value=e)});var t=web2py.isUndefined(w2p_ajax_confirm_message)?"Are you sure you want to delete this object?":w2p_ajax_confirm_message;e.on("click",'input[type="checkbox"].delete',function(){this.checked&&(web2py.confirm(t)||(this.checked=!1))});var a=web2py.isUndefined(w2p_ajax_datetime_format)?"%Y-%m-%d %H:%M:%S":w2p_ajax_datetime_format;e.on("click","input.datetime",function(){var e=$(this).data("w2p_datetime_format"),t=$(this).data("w2p_datetime"),e=web2py.isUndefined(e)?a:e;t===undefined&&(Calendar.setup({inputField:this,ifFormat:e,showsTime:!0,timeFormat:"24"}),$(this).attr("autocomplete","off"),$(this).data("w2p_datetime",1),$(this).trigger("click"))});var n=web2py.isUndefined(w2p_ajax_date_format)?"%Y-%m-%d":w2p_ajax_date_format;e.on("click","input.date",function(){var e=$(this).data("w2p_date_format"),t=$(this).data("w2p_date"),e=web2py.isUndefined(e)?n:e;t===undefined&&(Calendar.setup({inputField:this,ifFormat:e,showsTime:!1}),$(this).data("w2p_date",1),$(this).attr("autocomplete","off"),$(this).trigger("click"))}),e.on("focus","input.time",function(){var e=$(this).data("w2p_time");web2py.isUndefined(e)&&($(this).timeEntry({spinnerImage:""}).attr("autocomplete","off"),$(this).data("w2p_time",1))}),$(e).on("submit","form",function(e){var t=$(this).find(web2py.formInputClickSelector);t.each(function(){web2py.disableElement($(this))}),setTimeout(function(){t.each(function(){web2py.enableElement($(this))})},5e3)}),e.ajaxSuccess(function(e,t){var a=t.getResponseHeader("web2py-redirect-location");null!==a&&(window.location=a),null===t.getResponseHeader("web2py-component-content")&&web2py.after_ajax(t)}),e.ajaxError(function(e,t,a,n){500===t.status&&web2py.flash(ajax_error_500)})},trap_form:function(t,i){$("#"+i+" form").each(function(){var e,a,n=$(this);n.hasClass("no_trap")||(e=$(this).attr("data-w2p_target"),web2py.isUndefined(e)||!1===e?n.attr("data-w2p_target",i):i=e,""!==(a=n.attr("action"))&&"#"!==a&&!web2py.isUndefined(a)||(a=t),n.submit(function(e){var t;web2py.disableElement(n.find(web2py.formInputClickSelector)),web2py.hide_flash(),t=FORMDATA_IS_SUPPORTED?new FormData(n[0]):n.serialize(),web2py.ajax_page("post",a,t,i,n),e.preventDefault()}),n.on("click",web2py.formInputClickSelector,function(e){e.preventDefault();e=$(this).attr("name");web2py.isUndefined(e)||$('<input type="hidden" />').attr("name",e).attr("value",$(this).val()).appendTo(n),n.trigger("submit")}))})},ajax_page:function(e,a,t,n,i){web2py.isUndefined(i)&&(i=$(document)),!web2py.isUndefined(n)&&""!==n||(n="w2p_none");var o="[object FormData]"===Object.prototype.toString.call(t),r=!o&&"application/x-www-form-urlencoded; charset=UTF-8";web2py.fire(i,"ajax:before",null,n)&&$.ajax({type:e,url:a,data:t,processData:!o,contentType:r,beforeSend:function(e,t){return e.setRequestHeader("web2py-component-location",document.location),e.setRequestHeader("web2py-component-element",n),web2py.fire(i,"w2p:componentBegin",[e,t],n),web2py.fire(i,"ajax:beforeSend",[e,t],n)},success:function(e,t,a){web2py.fire(i,"ajax:success",[e,t,a],n)},error:function(e,t,a){web2py.fire(i,"ajax:error",[e,t,a],n)},complete:function(e,t){web2py.fire(i,"ajax:complete",[e,t],n),web2py.updatePage(e,n),web2py.trap_form(a,n),web2py.ajax_init("#"+n),web2py.after_ajax(e),web2py.fire(i,"w2p:componentComplete",[e,t],n)}})},component:function(n,i,o,r,s){$(function(){var e=$("#"+i),t=e.get(0),a='jQuery("#'+i+'").get(0).reload();';t.reload=function(){t.reload_check()&&web2py.ajax_page("get",n,null,i,s)},t.reload_check=function(){if(e.hasClass("w2p_component_stop"))return clearInterval(this.timing),!1;if(this.reload_counter==1/0)return!0;if(!isNaN(this.reload_counter)){if(--this.reload_counter,!(this.reload_counter<0))return!0;if(!this.run_once)return clearInterval(this.timing),!1}return!1},isNaN(o)?(t.reload_counter=1/0,web2py.ajax_page("get",n,null,i,s)):(t.timeout=o,1<(t.reload_counter=r)?(web2py.ajax_page("get",n,null,i,s),t.run_once=!1,t.timing=setInterval(a,o),--t.reload_counter):1==r&&(t.run_once=!0,t.setTimeout=setTimeout,t.timing=setTimeout(a,o)))})},updatePage:function(e,t){var a=$("#"+t),n=$.parseHTML(e.responseText,document,!0),i=$(n).filter("title").add($(n).find("title")),t=i.last().text();t&&(i.remove(),document.title=$.trim(t));t=e.getResponseHeader("web2py-component-content");"prepend"==t?a.prepend(e.responseText):"append"==t?a.append(e.responseText):"hide"!=t&&a.html(n)},calc_entropy:function(e){for(var t=new Array("abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ","0123456789","!@#$%^&*()","~`-_=+[]{}|;:'\",.<>?/","0123456789abcdefghijklmnopqrstuvwxyz"),a=0,n={},i={},o=null,r=e.split(""),s=0;s<r.length;s++){for(var p=r[s],d=5,l=0;l<t.length;l++)if(-1!=t[l].indexOf(p)){d=l;break}d in i?p in n||(a+=1,n[p]=1):(i[d]=1,a+=t[d].length),d!=o&&(a+=1,o=d)}e=e.length*Math.log(a)/.6931471805599453;return Math.round(100*e)/100},validate_entropy:function(i,o){web2py.isUndefined(i.data("w2p_entropy"))||(o=i.data("w2p_entropy"));function e(){var e=(web2py.calc_entropy(i.val())||0)/o,t=0,a=0,n=function(e){return Math.round(15*e).toString(16)},a=e<=.5?(t=1,2*e):(t=1-2*(Math.max(e,0)-.5),1),n="#"+n(t)+n(a)+n(0);i.css("background-color",n),(n=i.data("entropy_callback"))&&n(e)}i.hasClass("entropy_check")||i.on("keyup",e).on("keydown",e).addClass("entropy_check")},web2py_websocket:function(e,t,a,n){if("WebSocket"in window){e=new WebSocket(e);return e.onopen=a||function(){},e.onmessage=t,e.onclose=n||function(){},!0}return!1},formInputClickSelector:"input[type=submit], input[type=image], button[type=submit], button:not([type])",disableSelector:"input, button, textarea, select",enableSelector:"input:disabled, button:disabled, textarea:disabled, select:disabled",fire:function(e,t,a,n){n=$.Event(t,{containerTarget:$("#"+n)[0]});return e.trigger(n,a),!1!==n.result},stopEverything:function(e){return $(e.target).trigger("w2p:everythingStopped"),e.stopImmediatePropagation(),!1},confirm:function(e){return confirm(e)},disableElement:function(e){if(!web2py.isUndefined(e.data("w2p_disable")))return!1;e.addClass("disabled");var t=e.is("input")?"val":"html",a=web2py.isUndefined(w2p_ajax_disable_with_message)?"Working...":w2p_ajax_disable_with_message;web2py.isUndefined(e.data("w2p_enable_with"))&&e.data("w2p_enable_with",e[t]()),"default"!=e.data("w2p_disable_with")&&!web2py.isUndefined(e.data("w2p_disable_with"))||e.data("w2p_disable_with",a),e[t](e.data("w2p_disable_with")),e.bind("click.w2pDisable",function(e){return web2py.stopEverything(e)})},enableElement:function(e){var t=e.is("input")?"val":"html";web2py.isUndefined(e.data("w2p_enable_with"))||(e[t](e.data("w2p_enable_with")),e.removeData("w2p_enable_with")),e.removeClass("disabled"),e.unbind("click.w2pDisable")},simple_component:function(e,t,a){web2py.component(e,t,0,1,a)},flash:function(e,t){var a=$(".w2p_flash");web2py.hide_flash(),a.text(e).addClass(t),a.html()&&a.append('<span id="closeflash"> &times; </span>')[animateIn]()},hide_flash:function(){$(".w2p_flash").fadeOut(0).html("")},show_if_handler:function(o){function e(){var e=$(this),t=e.attr("id");e.attr("value",e.val());for(var a=0;a<r[t].length;a++){var n=$("#"+r[t][a],o),i=$("#"+r[t][a]+"__row",o);e.is(n.attr("data-show-if"))?i[animateIn]():i.hide()}}var t,r={};for(t in $("[data-show-trigger]",o).each(function(){var e=$(this).attr("data-show-trigger");$("#"+e).length&&(r[e]||(r[e]=[]),r[e].push($(this).attr("id")))}),r)$("#"+t,o).change(e).keyup(e),e.call($("#"+t,o))},component_handler:function(e){$("div[data-w2p_remote]",e).each(function(){var e=$(this),t=e.data("w2p_remote"),a=e.data("w2p_times"),n=e.data("w2p_timeout"),e=e.attr("id");web2py.component(t,e,n,a,$(this))})},a_handler:function(el,e){e.preventDefault();var method=el.data("w2p_method"),action=el.attr("href"),target=el.data("w2p_target"),confirm_message=el.data("w2p_confirm"),pre_call=el.data("w2p_pre_call");web2py.isUndefined(pre_call)||eval(pre_call),!confirm_message||("default"==confirm_message&&(confirm_message=web2py.isUndefined(w2p_ajax_confirm_message)?"Are you sure you want to delete this object?":w2p_ajax_confirm_message),web2py.confirm(confirm_message))?web2py.isUndefined(target)?"GET"==method?web2py.ajax_page("get",action,[],"",el):"POST"==method&&web2py.ajax_page("post",action,[],"",el):"GET"==method?web2py.ajax_page("get",action,[],target,el):"POST"==method&&web2py.ajax_page("post",action,[],target,el):web2py.stopEverything(e)},a_handlers:function(){var e=$(document);e.on("click","a[data-w2p_method]",function(e){web2py.a_handler($(this),e)}),e.on("ajax:success","a[data-w2p_method][data-w2p_remove]",function(){var e=$(this),t=e.data("w2p_remove");web2py.isUndefined(t)||((t=e.closest(t)).length||(t=$(t)),t.remove())}),e.on("ajax:beforeSend","a[data-w2p_method][data-w2p_disable_with]",function(){web2py.disableElement($(this))}),e.on("ajax:complete","a[data-w2p_method][data-w2p_disable_with]",function(){web2py.enableElement($(this))})},disableFormElements:function(e){e.find(web2py.disableSelector).each(function(){var e=$(this),t=e.is("button")?"html":"val",a=e.data("w2p_disable_with"),n=e.data("w2p_disable");if(!web2py.isUndefined(n))return!1;e.is(":file")||(web2py.isUndefined(a)&&e.data("w2p_disable_with",e[t]()),web2py.isUndefined(e.data("w2p_enable_with"))&&e.data("w2p_enable_with",e[t]()),e[t](e.data("w2p_disable_with"))),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(web2py.enableSelector).each(function(){var e=$(this),t=e.is("button")?"html":"val";e.data("w2p_enable_with")&&(e[t](e.data("w2p_enable_with")),e.removeData("w2p_enable_with")),e.prop("disabled",!1)})},form_handlers:function(){var e=$(document);e.on("ajax:beforeSend","form[data-w2p_target]",function(){web2py.disableFormElements($(this))}),e.on("ajax:complete","form[data-w2p_target]",function(){web2py.enableFormElements($(this))})},invalidate:function(e){$("div[data-w2p_remote]",e).each(function(){var e=$("#"+$(this).attr("id")).get(0);web2py.isUndefined(e.timing)||clearInterval(e.timing)}),$.web2py.component_handler(e)},main_hook:function(){var e=$(".w2p_flash");e.hide(),e.html()&&web2py.flash(e.html()),web2py.ajax_init(document),web2py.event_handlers(),web2py.a_handlers(),web2py.form_handlers()}},$(function(){web2py.main_hook()})}(jQuery),ajax=jQuery.web2py.ajax,web2py_component=jQuery.web2py.component,web2py_websocket=jQuery.web2py.web2py_websocket,web2py_ajax_page=jQuery.web2py.ajax_page,web2py_validate_entropy=jQuery.web2py.validate_entropy,web2py_ajax_fields=jQuery.web2py.ajax_fields,web2py_trap_form=jQuery.web2py.trap_form,popup=jQuery.web2py.popup,collapse=jQuery.web2py.collapse,fade=jQuery.web2py.fade;